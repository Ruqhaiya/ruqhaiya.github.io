---
title: 'Restricting Access in a Canvas App Using a SharePoint Group and Power Automate'
date: 2021-12-23
permalink: /posts/2012/08/blog-post-1/
tags:
  - cool posts
  - category1
  - category2
---
In this article, I will show you:

-> How to restrict users from accessing certain features in a canvas app, while other users can still see and use features.

-> How to use SharePoint action in Power Automate to authenticate a user.


## Why Restrict Access? 
In any App, there’s always more than one type of user. For example, there will be customers, staff, administrators, and so on in an event management application. An administrator will have access to everything; meanwhile, staff will have limited access. However, a customer can only access his data.

Therefore, we need to make sure that we restrict users from interacting with specific data or features. For example, using Power Automate, we can hide anything in our Canvas App from users so that they do not interact with it. But how do we know who has access to it and who does not? Through a SharePoint group!

We will create a SharePoint group and add the users who have complete access to the app, but before we move ahead, let us understand what SharePoint groups offer:

-> There are four types of SharePoint groups: Viewers, Visitors, Members, and Owners.               
-> Each group has different permission levels like view-only, read, edit and full-access.                 
-> You can assign a permission level to multiple users by simply moving them to a group.                

**Now that we know the basics let us break this article into pieces:**

1) Create a SharePoint group.                                                                          
2) Create a flow to authenticate users.                                                             
3) Create a simple canvas app.                                                                    
4) Hide elements in the canvas app using global variables.                                           
5) Bonus Tip.                                                            


###  One: Create a SharePoint Group

Apart from group names and descriptions, SharePoint allows you to choose permission levels. You can select any options based on your requirements.

After creating the group, add a user to it.

![Add-Users](https://github.com/user-attachments/assets/5cb053b0-dc4a-4715-bc85-4bc66ccc45f5)
![image](https://github.com/user-attachments/assets/85545496-55bc-429f-8a39-ed156cb197f4)

Note: Make sure this user is already present in your environment.


### Two: Create a Flow to Authenticate Users

Create an instant flow with PowerApps as a trigger and add three variables

![image](https://github.com/user-attachments/assets/5af05cd7-8847-4b57-97ea-61d22ad50ffd)

-> Email: This will be an input from the canvas app.
-> UserInfo – We’ll store user information that SharePoint API will fetch us.
-> ShouldAccess – This will initially be false.

Note: You can name these variables however you like.

Now Add the ‘Send HTTP Request to SharePoint’ action.

![image](https://github.com/user-attachments/assets/c4bc8bf4-6cb2-4dc0-899e-9ff157f82768)


Here we have some fields to fill. These fields are crucial, and we primarily run into errors in this step. So be careful.

Let’s break it down one by one.

1) Site Address: Select the site from the dropdown. Select the site where your group is.
2) Method: Select the GET method. Since we are requesting SharePoint to provide user data.
3) URI: We need to give the URI, which will fetch us data from the SharePoint group’s list.

**URI Structure**

![image](https://github.com/user-attachments/assets/59bc4f29-a98f-4ee9-b481-4f3ab576f28c)

-> /api/web/sitegroups – Take you to the site groups of SharePoint.
-> GetByName(‘’) – This function will go to a specific group on your site.
-> Users – It will take you to the user’s list in the group
-> $filter = Email eq ‘’ – This is a filter query that will check for the email id provided by you. It will fetch user details; 
   otherwise, it will send a blank response.

Note: The URI structure could be tested by simply pasting it in your browser. But don’t forget to add the SharePoint, Site Address + Uri.
It should return a json structure with user details. If it doesn’t, then your link is broken. Now save and test your flow.

![image](https://github.com/user-attachments/assets/6a646609-cf00-4f94-8bb0-41f040295876)

On a successful run, check the http response body. If the user is present, it will return the result like this:

![image](https://github.com/user-attachments/assets/a7586beb-44ed-4dfa-8216-4a9754bf5daf)


If the user is not present, then you will see an empty array like this:


![image](https://github.com/user-attachments/assets/6b2a9f42-c496-4306-a95a-0ded36da607d)


Now let us add a condition where we will check if the result is empty or if it returns the information about a user.


![image](https://github.com/user-attachments/assets/cb9d41da-5502-42f7-b7d9-3ccf2ddbde68)




------
